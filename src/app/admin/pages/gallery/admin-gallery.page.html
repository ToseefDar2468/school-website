<div class="space-y-6">
  @if (vm$ | async; as vm) {
    <div class="flex flex-col gap-4 lg:flex-row lg:items-center lg:justify-between">
      <div>
        <p class="text-xs uppercase tracking-[0.3em] text-emerald-400">Gallery</p>
        <h1 class="text-2xl font-semibold text-white">Albums</h1>
        <p class="mt-1 text-sm text-slate-400">Manage photo collections for school events.</p>
      </div>
      <button
        type="button"
        class="inline-flex items-center justify-center rounded-full bg-emerald-500 px-5 py-2 text-sm font-semibold text-slate-950 transition hover:bg-emerald-400"
        (click)="openCreate()"
      >
        Create Album
      </button>
    </div>

    @if (vm.errorMessage) {
      <div class="rounded-2xl border border-rose-500/40 bg-rose-500/10 px-4 py-3 text-sm text-rose-100">
        {{ vm.errorMessage }}
      </div>
    }

    @if (vm.isLoading) {
      <div class="rounded-3xl border border-slate-800 bg-slate-900/60 p-8 text-center text-sm text-slate-300">
        Loading albums...
      </div>
    } @else {
      @if (vm.albums.length) {
        <div class="overflow-hidden rounded-3xl border border-slate-800 bg-slate-900/60">
          <div
            class="grid grid-cols-[2.1fr_1fr_0.8fr_1fr] gap-4 border-b border-slate-800 bg-slate-950/70 px-6 py-4 text-xs uppercase tracking-[0.25em] text-slate-500"
          >
            <span>Title</span>
            <span>Category</span>
            <span>Images</span>
            <span>Actions</span>
          </div>

          @for (album of vm.albums; track album.id) {
            <div
              class="grid grid-cols-[2.1fr_1fr_0.8fr_1fr] gap-4 border-b border-slate-800 px-6 py-4 text-sm text-slate-300 last:border-b-0"
            >
              <div>
                <p class="font-semibold text-white">{{ album.title }}</p>
                <p class="mt-1 text-xs text-slate-500">Cover: {{ album.coverImageUrl }}</p>
              </div>
              <div class="text-slate-200">{{ album.category }}</div>
              <div class="text-slate-400">{{ album.imageUrls.length }}</div>
              <div class="flex flex-wrap items-center gap-2">
                <button
                  type="button"
                  class="rounded-full border border-slate-700 px-3 py-1 text-xs font-semibold text-slate-200 hover:border-slate-500"
                  (click)="openEdit(album)"
                >
                  Edit
                </button>
                <button
                  type="button"
                  class="rounded-full border border-rose-500/40 px-3 py-1 text-xs font-semibold text-rose-200 hover:border-rose-400"
                  [disabled]="vm.isDeleting && vm.deleteTarget?.id === album.id"
                  (click)="openDelete(album)"
                >
                  {{ vm.isDeleting && vm.deleteTarget?.id === album.id ? 'Deleting...' : 'Delete' }}
                </button>
              </div>
            </div>
          }
        </div>
      } @else {
        <div class="rounded-3xl border border-dashed border-slate-700 bg-slate-900/40 p-10 text-center">
          <p class="text-sm text-slate-300">No albums yet.</p>
          <p class="mt-2 text-xs text-slate-500">Create the first album to get started.</p>
        </div>
      }
    }

    <app-admin-modal
      [open]="vm.formOpen"
      [title]="vm.editingAlbum ? 'Edit Album' : 'Create Album'"
      [subtitle]="vm.editingAlbum ? 'Update the album details.' : 'Publish a new album.'"
      (closed)="closeForm()"
    >
      <form class="space-y-4" [formGroup]="form" (ngSubmit)="submit()">
        <div class="space-y-2">
          <label class="text-xs font-semibold uppercase tracking-[0.2em] text-slate-400">Title</label>
          <input
            type="text"
            class="w-full rounded-xl border border-slate-700 bg-slate-950 px-4 py-3 text-sm text-white placeholder:text-slate-600 focus:border-emerald-400 focus:outline-none"
            placeholder="Album title"
            formControlName="title"
          />
          @if (form.controls.title.touched && form.controls.title.invalid) {
            <p class="text-xs text-rose-300">Title is required.</p>
          }
        </div>

        <div class="space-y-2">
          <label class="text-xs font-semibold uppercase tracking-[0.2em] text-slate-400">Category</label>
          <input
            type="text"
            class="w-full rounded-xl border border-slate-700 bg-slate-950 px-4 py-3 text-sm text-white placeholder:text-slate-600 focus:border-emerald-400 focus:outline-none"
            placeholder="Sports, Academics, Trips"
            formControlName="category"
          />
          @if (form.controls.category.touched && form.controls.category.invalid) {
            <p class="text-xs text-rose-300">Category is required.</p>
          }
        </div>

        <div class="space-y-2">
          <label class="text-xs font-semibold uppercase tracking-[0.2em] text-slate-400">Cover Image URL</label>
          <input
            type="url"
            class="w-full rounded-xl border border-slate-700 bg-slate-950 px-4 py-3 text-sm text-white placeholder:text-slate-600 focus:border-emerald-400 focus:outline-none"
            placeholder="https://"
            formControlName="coverImageUrl"
          />
          @if (form.controls.coverImageUrl.touched && form.controls.coverImageUrl.invalid) {
            <p class="text-xs text-rose-300">Cover image URL is required.</p>
          }
        </div>

        <div class="space-y-3">
          <div class="flex items-center justify-between">
            <label class="text-xs font-semibold uppercase tracking-[0.2em] text-slate-400">Image URLs</label>
            <button
              type="button"
              class="rounded-full border border-slate-700 px-3 py-1 text-xs font-semibold text-slate-200 hover:border-slate-500"
              (click)="addImageUrl()"
            >
              Add URL
            </button>
          </div>

          <div class="space-y-3">
            @for (control of imageControls; track $index) {
              <div class="flex items-center gap-3">
                <input
                  type="url"
                  class="w-full rounded-xl border border-slate-700 bg-slate-950 px-4 py-3 text-sm text-white placeholder:text-slate-600 focus:border-emerald-400 focus:outline-none"
                  placeholder="https://"
                  [formControl]="control"
                />
                <button
                  type="button"
                  class="rounded-full border border-slate-700 px-3 py-1 text-xs font-semibold text-slate-200 hover:border-slate-500"
                  (click)="removeImageUrl($index)"
                >
                  Remove
                </button>
              </div>
            }
          </div>
        </div>

        <div class="flex flex-wrap items-center justify-end gap-3">
          <button
            type="button"
            class="rounded-full border border-slate-700 px-4 py-2 text-xs font-semibold text-slate-200 hover:border-slate-500"
            (click)="closeForm()"
          >
            Cancel
          </button>
          <button
            type="submit"
            class="rounded-full bg-emerald-500 px-5 py-2 text-xs font-semibold text-slate-950 transition hover:bg-emerald-400 disabled:cursor-not-allowed disabled:opacity-60"
            [disabled]="vm.isSaving"
          >
            {{ vm.isSaving ? 'Saving...' : vm.editingAlbum ? 'Update Album' : 'Create Album' }}
          </button>
        </div>
      </form>
    </app-admin-modal>

    <app-admin-modal
      [open]="vm.deleteOpen"
      title="Delete album"
      subtitle="This action cannot be undone."
      (closed)="closeDelete()"
    >
      <p class="text-sm text-slate-300">
        @if (vm.deleteTarget) {
          Are you sure you want to delete "{{ vm.deleteTarget.title }}"?
        } @else {
          Are you sure you want to delete this album?
        }
      </p>
      <div class="mt-6 flex flex-wrap items-center justify-end gap-3">
        <button
          type="button"
          class="rounded-full border border-slate-700 px-4 py-2 text-xs font-semibold text-slate-200 hover:border-slate-500"
          (click)="closeDelete()"
        >
          Cancel
        </button>
        <button
          type="button"
          class="rounded-full border border-rose-500/40 px-5 py-2 text-xs font-semibold text-rose-200 hover:border-rose-400 disabled:cursor-not-allowed disabled:opacity-60"
          [disabled]="vm.isDeleting"
          (click)="confirmDelete()"
        >
          {{ vm.isDeleting ? 'Deleting...' : 'Delete' }}
        </button>
      </div>
    </app-admin-modal>
  }
</div>
